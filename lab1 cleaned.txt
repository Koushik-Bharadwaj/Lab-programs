-- Creating databases and tables
CREATE DATABASE LABB1;
USE LABB1;

CREATE TABLE PUBLISHER (
    NAME VARCHAR(20) PRIMARY KEY,
    PHONE INTEGER,
    ADDRESS VARCHAR(20)
);

CREATE TABLE BOOK (
    BOOK_ID INTEGER PRIMARY KEY,
    TITLE VARCHAR(20),
    PUBLISHER_NAME VARCHAR(20),
    PUB_YEAR YEAR,
    FOREIGN KEY (PUBLISHER_NAME) REFERENCES PUBLISHER(NAME)
);

CREATE TABLE BOOK_AUTHORS (
    AUTHOR_NAME VARCHAR(20),
    BOOK_ID INTEGER,
    PRIMARY KEY (BOOK_ID, AUTHOR_NAME),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE
);

CREATE TABLE LIBRARY_BRANCH (
    BRANCH_ID INTEGER PRIMARY KEY,
    BRANCH_NAME VARCHAR(50),
    ADDRESS VARCHAR(50)
);

CREATE TABLE BOOK_COPIES (
    BOOK_ID INTEGER,
    PROGRAM_ID INTEGER,
    NO_OF_COPIES INTEGER,
    PRIMARY KEY (BOOK_ID, PROGRAM_ID),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
    FOREIGN KEY (PROGRAM_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE
);

CREATE TABLE CARD (
    CARD_NO INTEGER PRIMARY KEY
);

CREATE TABLE BOOK_LENDING (
    BOOK_ID INTEGER,
    PROGRAM_ID INTEGER,
    CARD_NO INTEGER,
    DATE_OUT DATE,
    DUE_DATE DATE,
    PRIMARY KEY (BOOK_ID, PROGRAM_ID, CARD_NO),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
    FOREIGN KEY (PROGRAM_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
    FOREIGN KEY (CARD_NO) REFERENCES CARD(CARD_NO) ON DELETE CASCADE
);

-- Inserting data
INSERT INTO PUBLISHER VALUES('PEARSON', 87654, 'MYSORE');
INSERT INTO BOOK VALUES(101, 'DATABASE SYSTEM', 'PEARSON', 2021);
INSERT INTO BOOK_AUTHORS VALUES(101, 'DONLAND');
INSERT INTO LIBRARY_PROGRAM VALUES(4001, 'COMPUTERS', 'MYSORE');
INSERT INTO BOOK_COPIES VALUES(101, 4001, 15);
INSERT INTO BOOK_LENDING VALUES(101, 4001, 901, '2021-11-15', '2021-11-30');

-- Querying data
SELECT * FROM PUBLISHER;
SELECT * FROM BOOK;
SELECT * FROM LIBRARY_PROGRAM;
SELECT * FROM BOOK_COPIES;
SELECT * FROM BOOK_LENDING;
